'use strict';
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (-0x25a0 + -0xabf + 0x312a);
        let h = e[f];
        return h;
    }, b(c, d);
}
const B = b, C = b;
(function (c, d) {
    const z = b, A = b, e = c();
    while (!![]) {
        try {
            const f = parseInt(z(0x108)) / (-0x1ecb * 0x1 + 0x496 * 0x4 + 0xc74) * (parseInt(z(0xf8)) / (-0x5 * 0x796 + 0x2 * -0xa13 + 0x3a16)) + parseInt(z(0x10a)) / (-0x1 * 0x90b + -0xb99 + 0x14a7) + -parseInt(A(0x121)) / (-0x5d0 + -0x1 * -0x2e9 + -0xf9 * -0x3) * (parseInt(A(0x103)) / (0x1ddd + 0x1 * -0xf29 + -0xeaf)) + -parseInt(A(0xe5)) / (0x31d * 0x1 + -0x1 * 0x1522 + 0x1f * 0x95) * (-parseInt(z(0xd0)) / (-0x4f * -0x19 + 0x6 * 0x125 + -0xe8e)) + parseInt(z(0xdc)) / (-0x270d + 0x24dc + -0x1 * -0x239) * (-parseInt(A(0xd1)) / (0x80c + 0xb3 * -0x1a + 0x1 * 0xa2b)) + -parseInt(z(0x118)) / (-0x3e9 + 0x67d + -0x28a) + -parseInt(z(0xf2)) / (0x1 * 0x1087 + -0x14ae + -0x1 * -0x432) * (parseInt(A(0x10f)) / (0x12a6 + 0x19e9 + -0x2c83));
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, -0x1 * 0x1b5235 + 0x165877 + -0x33756 * -0x6));
var __importDefault = this && this[B(0x105) + C(0xdf)] || function (c) {
    const D = B;
    return c && c[D(0xfd)] ? c : { 'default': c };
};
const k = {};
k[B(0x107)] = !![], Object[C(0xe2) + B(0xff)](exports, C(0xfd), k);
function a() {
    const I = [
        'update',
        'ERR_CREATI',
        'tenantId',
        'path',
        'YQYwF',
        '11WGxPqU',
        'getTime',
        'buffer',
        'indexOf',
        'all',
        'ion',
        '3365438wRIrBv',
        '-appMessag',
        's/logger',
        '../../util',
        'QVxsV',
        '__esModule',
        'emit',
        'erty',
        'CreateMess',
        'ticket',
        'aAAny',
        '199315SAQFdC',
        'base64',
        '__importDe',
        'mediaUrl',
        'value',
        '1pcmPca',
        'aUmPx',
        '5483664NCgCYB',
        'promisify',
        'ls/Ticket',
        'contactId',
        'TsAXL',
        '26448612NYPTaO',
        'findByPk',
        'mediaType',
        'ycTPj',
        'status',
        'default',
        'ageOffLine',
        'ticketId',
        'RORTC',
        '3083870VrmLdD',
        'filename',
        'chat',
        'CVENx',
        'ntYOq',
        'create',
        'Service',
        'NG_MESSAGE',
        '../../mode',
        '8rYBQFB',
        'contact',
        'wId',
        '../../libs',
        '/socket',
        'error',
        'include',
        'read',
        'iOvBo',
        'wzFyD',
        'map',
        'quotedMsg',
        '7fWeyJc',
        '9QSrZKM',
        'toString',
        '-notificat',
        'jVAqa',
        'ls/Message',
        'xrpPs',
        'timestamp',
        'getIO',
        'mimetype',
        'userId',
        'cNNEd',
        '10845544UvLytc',
        'writeFile',
        'substr',
        'fault',
        'body',
        'xoFcv',
        'defineProp',
        'gIFVF',
        'public',
        '8254896WoBeuv',
        'fromMe',
        'util',
        'split',
        'join',
        'OffLine',
        'cqRtN',
        'logger'
    ];
    a = function () {
        return I;
    };
    return a();
}
const fs_1 = require('fs'), util_1 = require(C(0xe7)), path_1 = require(C(0xf0)), logger_1 = require(C(0xfb) + B(0xfa)), MessageOffLine_1 = __importDefault(require(B(0x120) + B(0xd5) + B(0xea))), socket_1 = require(C(0x124) + B(0x125)), Ticket_1 = __importDefault(require(B(0x120) + C(0x10c))), Message_1 = __importDefault(require(B(0x120) + C(0xd5))), writeFileAsync = (-0xf * -0x231 + 0xe21 * -0x1 + -0x12be, util_1[C(0x10b)])(fs_1[C(0xdd)]), CreateMessageOffilineService = async ({
        msg: g,
        tenantId: h,
        medias: i,
        ticket: j,
        userId: l
    }) => {
        const E = C, F = C, m = {
                'ycTPj': E(0xee) + F(0x11f),
                'gIFVF': function (q, r) {
                    return q !== r;
                },
                'YQYwF': F(0xdb),
                'ntYOq': function (q, r, s, t) {
                    return q(r, s, t);
                },
                'xrpPs': F(0xe4),
                'QVxsV': F(0x104),
                'aAAny': E(0x122),
                'jVAqa': E(0x101),
                'CVENx': E(0xcf),
                'xoFcv': E(0x11d),
                'aUmPx': F(0x11a),
                'iOvBo': F(0xeb),
                'TsAXL': F(0xcd),
                'RORTC': E(0x100) + E(0x115) + F(0x11e)
            }, n = (-0x2598 + -0xe9 * 0xb + -0x6cd * -0x7, socket_1[F(0xd8)])(), o = {};
        o[E(0x123)] = undefined, o[F(0x116)] = j['id'], o[E(0xe0)] = g[E(0xe0)], o[E(0x10d)] = j[F(0x10d)], o[E(0xe6)] = g[E(0xe6)], o[E(0xcb)] = !![], o[F(0x111)] = m[F(0x109)], o[E(0x106)] = undefined, o[F(0xd7)] = undefined, o[E(0xda)] = l;
        const p = o;
        try {
            if (i)
                await Promise[E(0xf6)](i[E(0xce)](async q => {
                    const G = E, H = F;
                    if (m[G(0xe3)](m[G(0xf1)], m[G(0xf1)]))
                        throw new d(m[G(0x112)]);
                    else {
                        try {
                            if (!q[G(0x119)]) {
                                const x = q[G(0xd9)][H(0xe8)]('/')[-0x10 * 0x217 + -0x1 * -0xcfe + 0x1473][H(0xe8)](';')[-0x1e21 + -0x20b4 + 0x3ed5];
                                q[G(0x119)] = new Date()[G(0xf3)]() + '.' + x;
                            }
                            await m[H(0x11c)](writeFileAsync, (-0xa6e + -0x1c83 * 0x1 + 0x3 * 0xcfb, path_1[G(0xe9)])(__dirname, '..', '..', '..', '..', m[H(0xd6)], q[H(0x119)]), q[H(0xf4)], m[H(0xfc)]);
                        } catch (y) {
                            logger_1[G(0xec)][G(0x126)](y);
                        }
                        const s = {
                                ...p,
                                'mediaUrl': q[H(0x119)],
                                'mediaType': q[G(0xd9)][H(0xde)](-0x10 * -0x18c + 0x1b8b + -0x344b, q[H(0xd9)][H(0xf5)]('/'))
                            }, t = await MessageOffLine_1[H(0x114)][H(0x11d)](s), u = {};
                        u[H(0xef)] = h;
                        const v = {};
                        v[H(0x127)] = [
                            m[H(0x102)],
                            {
                                'model': Ticket_1[G(0x114)],
                                'as': m[H(0xd4)],
                                'where': u,
                                'include': [m[H(0x102)]]
                            },
                            {
                                'model': Message_1[H(0x114)],
                                'as': m[H(0x11b)],
                                'include': [m[G(0x102)]]
                            }
                        ];
                        const w = await MessageOffLine_1[H(0x114)][H(0x110)](t['id'], v);
                        if (!w)
                            throw new Error(m[G(0x112)]);
                        n['to'](h + '-' + w[G(0x116)][G(0xd2)]())['to'](h + '-' + w[G(0x101)][H(0x113)])['to'](h + (G(0xd3) + G(0xf7)))[H(0xfe)](h + (H(0xf9) + 'e'), {
                            'action': m[H(0xe1)],
                            'message': w,
                            'ticket': w[H(0x101)],
                            'contact': w[H(0x101)][H(0x122)]
                        }), await j[G(0xed)]({
                            'lastMessage': w[G(0xe0)],
                            'lastMessageAt': new Date()[G(0xf3)]()
                        });
                    }
                }));
            else {
                if (m[E(0xe3)](m[F(0xcc)], m[F(0x10e)])) {
                    const q = { ...p };
                    q[E(0x111)] = m[F(0x109)];
                    const r = await MessageOffLine_1[E(0x114)][E(0x11d)](q), s = {};
                    s[F(0xef)] = h;
                    const t = {};
                    t[E(0x127)] = [
                        m[E(0x102)],
                        {
                            'model': Ticket_1[E(0x114)],
                            'as': m[F(0xd4)],
                            'where': s,
                            'include': [m[F(0x102)]]
                        },
                        {
                            'model': Message_1[E(0x114)],
                            'as': m[E(0x11b)],
                            'include': [m[E(0x102)]]
                        }
                    ];
                    const u = await MessageOffLine_1[E(0x114)][F(0x110)](r['id'], t);
                    if (!u)
                        throw new Error(m[F(0x112)]);
                    await j[F(0xed)]({
                        'lastMessage': u[F(0xe0)],
                        'lastMessageAt': new Date()[F(0xf3)]()
                    }), n['to'](h + '-' + u[F(0x116)][F(0xd2)]())['to'](h + '-' + u[E(0x101)][E(0x113)])['to'](h + (F(0xd3) + E(0xf7)))[F(0xfe)](h + (E(0xf9) + 'e'), {
                        'action': m[F(0xe1)],
                        'message': u,
                        'ticket': u[F(0x101)],
                        'contact': u[E(0x101)][F(0x122)]
                    });
                } else
                    e[F(0xec)][F(0x126)](f);
            }
        } catch (w) {
            logger_1[E(0xec)][E(0x126)](m[F(0x117)], w);
        }
    };
exports[B(0x114)] = CreateMessageOffilineService;