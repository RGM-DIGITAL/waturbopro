'use strict';
const P = b, Q = b;
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (0x3 * 0x347 + 0x2 * -0xc09 + 0x7 * 0x23b);
        let h = e[f];
        return h;
    }, b(c, d);
}
(function (c, d) {
    const N = b, O = b, e = c();
    while (!![]) {
        try {
            const f = parseInt(N(0x17d)) / (0x1 * 0x1ef + 0x1 * -0x763 + -0x1 * -0x575) + parseInt(O(0x185)) / (0x416 * 0x5 + -0x64a * 0x2 + -0x7d8) + -parseInt(N(0x21c)) / (-0x22b7 + 0x252 + 0x2068) + parseInt(O(0x1d0)) / (0x3e4 + -0x19f8 + 0x1618) * (parseInt(O(0x191)) / (0x1351 + 0x2192 * 0x1 + 0x1a6f * -0x2)) + parseInt(O(0x189)) / (-0x1b * 0x92 + -0x1a5 * -0x1 + 0xdc7 * 0x1) * (-parseInt(O(0x1c2)) / (0x1417 + -0x7e * 0x4c + -0x1 * -0x1158)) + -parseInt(O(0x1ad)) / (0x14e9 + 0x2e3 * -0x1 + -0x149 * 0xe) + -parseInt(O(0x20d)) / (0xcd4 + -0xb9f + 0x1e * -0xa) * (-parseInt(O(0x1b8)) / (0x2597 + 0xb4a + -0x30d7));
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, -0x11ff17 + 0x4361 * -0x23 + 0x9855b * 0x4));
var __importDefault = this && this[P(0x1f1) + Q(0x179)] || function (c) {
    const R = P;
    return c && c[R(0x1be)] ? c : { 'default': c };
};
const J = {};
function a() {
    const ab = [
        'message',
        'mediaUrl',
        'axios',
        'Emit',
        'iXkec',
        'Status',
        'XwZQQ',
        'extension',
        'ycyee',
        '__importDe',
        'fjHky',
        'messageId',
        'idation',
        'vyeAI',
        'defineProp',
        '../../util',
        'RRonY',
        'CQlAd',
        'cWJHl',
        'xUxfm',
        'headers',
        'findByPk',
        'WmjEk',
        'map',
        'BZBWW',
        'kLPqc',
        'ACNmT',
        'yPhLN',
        'split',
        'XFCTK',
        'acFns',
        'whatsappId',
        'eStatus',
        'reare',
        'payload',
        'wbwBE',
        'vkcQf',
        '5027958LWmHhG',
        'PUGuh',
        'quotedMsg',
        'ticket',
        'vtDnZ',
        'uuid',
        'PtQuC',
        'chat',
        'eGwdf',
        'chat:creat',
        'igpbW',
        'apiConfig',
        'FkuWn',
        'ivvFZ',
        'ack',
        '1359036QNGKxy',
        'AsbyS',
        'push',
        'DxnRx',
        'tenantId',
        'avEpj',
        'xTsbd',
        'mime',
        'ERROR\x20DONW',
        's/queueVal',
        'type',
        'content-ty',
        'update',
        'Qwdhz',
        'NiUlw',
        'VAvlp',
        'KfUYH',
        'authToken',
        's/pupa',
        'gyzuY',
        'recursive',
        'cLBxE',
        'urlMessage',
        'externalKe',
        'fucLQ',
        'BQGqK',
        'status',
        'responseTy',
        'model',
        'QpTSz',
        'EKqyN',
        'fromMe',
        '../../libs',
        'CobTY',
        'fault',
        '/Queue',
        'contactId',
        'indexOf',
        '471145yBSNAW',
        'logger',
        'tnqZB',
        'AacNX',
        'pupa',
        'scheduleDa',
        'protocol',
        'jqFhr',
        '412116dXwFKA',
        'default',
        'contact',
        'MabWa',
        '6msTUQh',
        'ageSystemS',
        'public',
        'tWAGx',
        'eStream',
        '../../mode',
        'finish',
        'vlAEv',
        '163815jjzXYS',
        'NG_MESSAGE',
        'CreateMess',
        'kbyPZ',
        'get',
        'xggFU',
        'NlmEh',
        'RgxBt',
        'lAwLo',
        'ehoLt',
        'snPcC',
        'COHVh',
        'add',
        'WebHooksAP',
        'include',
        'create',
        'oMjBE',
        'originalna',
        'FRUNg',
        'ERR_CREATI',
        'xBOKN',
        'getTime',
        'stream',
        'data',
        'ervice',
        'erty',
        'lKmWw',
        'url',
        '8465472yuCiMG',
        'mediaType',
        'upoup',
        'error',
        'rMvyt',
        'where',
        'ydEhY',
        'ZGtyp',
        'jJVTN',
        'value',
        'PBcaz',
        '50lKNBxh',
        'Zwhii',
        'ls/Message',
        'WfNgt',
        'EsVyr',
        'CPjMd',
        '__esModule',
        'ZgXrl',
        'rmdirSync',
        'all',
        '9414188ACSSSo',
        'hjKAv',
        'ICOPO',
        'yFSPE',
        's/logger',
        'kGNKD',
        'LOAD',
        'Wijey',
        'join',
        'aRISm',
        'Fuprr',
        'path',
        'substr',
        'createWrit',
        '12uZeEER',
        'ObkMb',
        'KXnEz',
        'hookMessag',
        '../../help',
        'number',
        '_SYSTEM',
        'filename',
        'LGjBS',
        'mimetype',
        'RBUOe',
        'fGOhO',
        'ers/socket',
        'response',
        'API',
        'body',
        'name',
        'pipe',
        'QmCvk',
        'wsnHg',
        'media',
        'wbcSL',
        'ulWVm',
        'ls/Ticket'
    ];
    a = function () {
        return ab;
    };
    return a();
}
J[P(0x1b6)] = !![], Object[P(0x1f6) + Q(0x1aa)](exports, P(0x1be), J);
const fs_1 = __importDefault(require('fs')), path_1 = require(P(0x1cd)), axios_1 = __importDefault(require(P(0x1ea))), mime_1 = __importDefault(require(Q(0x223))), uuid_1 = require(P(0x212)), logger_1 = require(Q(0x1f7) + Q(0x1c6)), Ticket_1 = __importDefault(require(P(0x18e) + Q(0x1e7))), Message_1 = __importDefault(require(P(0x18e) + P(0x1ba))), socketEmit_1 = __importDefault(require(P(0x1d4) + Q(0x1dc) + Q(0x1eb))), Queue_1 = __importDefault(require(P(0x177) + P(0x17a))), pupa_1 = require(P(0x1f7) + P(0x169)), queueValidation_1 = __importDefault(require(P(0x1f7) + P(0x160) + P(0x1f4))), downloadMedia = async g => {
        const S = P, T = P, h = {
                'hjKAv': function (i, j) {
                    return i(j);
                },
                'upoup': S(0x224) + T(0x1c8),
                'oMjBE': T(0x18f),
                'reare': T(0x1b0),
                'yPhLN': function (i, j) {
                    return i !== j;
                },
                'xBOKN': T(0x1d2),
                'Fuprr': S(0x16c),
                'WfNgt': S(0x1a4) + S(0x192) + S(0x1d6),
                'kLPqc': function (i, j) {
                    return i === j;
                },
                'jJVTN': T(0x1a3),
                'Qwdhz': S(0x1f5),
                'MabWa': function (i, j) {
                    return i(j);
                },
                'wsnHg': T(0x19b),
                'RRonY': function (i, j) {
                    return i !== j;
                },
                'QpTSz': T(0x1d8),
                'EKqyN': S(0x1a7),
                'PUGuh': S(0x162) + 'pe',
                'Zwhii': S(0x18b),
                'igpbW': S(0x1d3) + S(0x208),
                'BZBWW': function (i, j) {
                    return i !== j;
                },
                'XFCTK': S(0x1e5),
                'eGwdf': S(0x199),
                'EsVyr': T(0x19e) + 'I'
            };
        try {
            if (h[S(0x1f8)](h[S(0x174)], h[T(0x174)]))
                m[T(0x1a8)][T(0x1e1)](n[T(0x186)][T(0x1cf) + S(0x18d)](o))['on'](h[T(0x1a1)], async () => {
                    const U = T;
                    h[U(0x1c3)](w, x);
                })['on'](h[T(0x209)], D => {
                    const V = T, W = S;
                    w[V(0x1b0)](h[V(0x1af)], D);
                    const E = {};
                    E[W(0x16b)] = !![], x[W(0x186)][V(0x1c0)](y, E), h[W(0x1c3)](z, new A(D));
                });
            else {
                const j = {};
                j[T(0x172) + 'pe'] = h[T(0x175)];
                const k = await axios_1[S(0x186)][T(0x195)](g[S(0x1e9)], j), l = k[S(0x1fc)][h[T(0x20e)]], m = mime_1[T(0x186)], n = m[T(0x1ef)](l), o = (0x1 * -0x249a + 0x2592 + -0x7c * 0x2, uuid_1['v4'])(), p = (-0x46 * -0x19 + -0x1 * 0x2587 + 0x1eb1, path_1[S(0x1ca)])(__dirname, '..', '..', '..', h[S(0x1b9)]), q = o + '.' + n, r = (0xb * 0x77 + 0x1 * -0x17ff + 0x12e2, path_1[T(0x1ca)])(p, q), s = {};
                s[T(0x1a2) + 'me'] = q, s[S(0x1d7)] = q, s[T(0x1ae)] = n;
                const t = s;
                return await new Promise((u, v) => {
                    const X = T, Z = T, w = {
                            'ehoLt': h[X(0x1bb)],
                            'iXkec': function (z, A) {
                                const Y = X;
                                return h[Y(0x201)](z, A);
                            },
                            'RgxBt': h[Z(0x1b5)],
                            'yFSPE': h[Z(0x164)],
                            'XwZQQ': h[Z(0x1af)],
                            'PtQuC': function (x, y) {
                                const a0 = Z;
                                return h[a0(0x188)](x, y);
                            }
                        };
                    if (h[Z(0x203)](h[X(0x1e3)], h[X(0x1e3)]))
                        throw new s(w[Z(0x19a)]);
                    else
                        k[X(0x1a8)][X(0x1e1)](fs_1[X(0x186)][Z(0x1cf) + Z(0x18d)](r))['on'](h[X(0x1a1)], async () => {
                            const a1 = X, a2 = Z;
                            h[a1(0x203)](h[a2(0x1a5)], h[a1(0x1cc)]) ? h[a1(0x1c3)](u, t) : (f = [], g[a2(0x21e)](h[a1(0x1e4)]));
                        })['on'](h[Z(0x209)], y => {
                            const a3 = X, a4 = Z;
                            if (w[a3(0x1ec)](w[a3(0x198)], w[a3(0x1c5)]))
                                e[a4(0x17e)][a4(0x1b0)](f);
                            else {
                                console[a4(0x1b0)](w[a4(0x1ee)], y);
                                const A = {};
                                A[a3(0x16b)] = !![], fs_1[a4(0x186)][a4(0x1c0)](r, A), w[a3(0x213)](v, new Error(y));
                            }
                        });
                }), t;
            }
        } catch (u) {
            if (h[S(0x201)](u[T(0x1dd)][T(0x171)], -0x1 * -0x26b0 + -0x1e49 * 0x1 + -0x6d3 * 0x1)) {
                const v = {};
                v[T(0x21b)] = -(-0x2 * 0xe59 + -0x2 * 0x1e7 + 0x1 * 0x2081), v[S(0x1df)] = g[T(0x1df)], v[T(0x1f3)] = '', v[S(0x1d5)] = g[T(0x1d5)], v[T(0x16e) + 'y'] = g[S(0x16e) + 'y'], v[T(0x1b0)] = u[S(0x1e8)], v[T(0x168)] = g[S(0x218)][T(0x168)], v[S(0x161)] = h[S(0x217)];
                const w = v;
                if (g?.[T(0x218)]?.[S(0x16d) + S(0x1ed)]) {
                    if (h[S(0x200)](h[T(0x205)], h[S(0x215)])) {
                        const x = {};
                        x[T(0x1ac)] = g[T(0x218)][S(0x16d) + S(0x1ed)], x[T(0x161)] = w[S(0x161)], x[S(0x20a)] = w, Queue_1[T(0x186)][S(0x19d)](h[T(0x1bc)], x);
                    } else {
                        j[S(0x1b0)](h[T(0x1af)], k);
                        const z = {};
                        z[T(0x16b)] = !![], l[T(0x186)][T(0x1c0)](m, z), h[T(0x188)](n, new o(p));
                    }
                }
                return {};
            }
            throw new Error(u);
        }
    }, CreateMessageSystemService = async ({
        msg: h,
        tenantId: i,
        medias: j,
        ticket: k,
        userId: l,
        scheduleDate: m,
        sendType: n,
        status: o,
        idFront: p
    }) => {
        const a5 = Q, a6 = Q, q = {
                'lKmWw': a5(0x193) + a6(0x18a) + a5(0x1a9),
                'DxnRx': a5(0x1a4) + a5(0x192) + a5(0x1d6),
                'rMvyt': a5(0x1d3) + a6(0x208),
                'tnqZB': a5(0x19e) + 'I',
                'fucLQ': function (s, t) {
                    return s === t;
                },
                'vtDnZ': function (s, t) {
                    return s(t);
                },
                'RBUOe': function (s, t) {
                    return s !== t;
                },
                'ydEhY': a6(0x20b),
                'KfUYH': a6(0x184),
                'kbyPZ': a5(0x1fe),
                'ZGtyp': function (s, t) {
                    return s === t;
                },
                'NiUlw': a5(0x1f2),
                'vlAEv': a5(0x206),
                'gyzuY': a5(0x210),
                'xTsbd': a5(0x187),
                'CPjMd': a6(0x20f),
                'COHVh': a5(0x216) + 'e',
                'VAvlp': function (s, t) {
                    return s === t;
                },
                'xggFU': a6(0x1bf),
                'ivvFZ': a5(0x1db),
                'BQGqK': function (s, t) {
                    return s === t;
                },
                'ACNmT': a6(0x1de),
                'QmCvk': a6(0x214),
                'CobTY': function (s, t) {
                    return s === t;
                },
                'vkcQf': a5(0x1cb),
                'ICOPO': function (s, t) {
                    return s !== t;
                },
                'PBcaz': a5(0x1d1),
                'NlmEh': a6(0x1c9),
                'CQlAd': a6(0x219),
                'AacNX': a6(0x1f0),
                'xUxfm': function (s, t) {
                    return s !== t;
                },
                'tWAGx': a5(0x221)
            }, r = {
                'ticketId': k['id'],
                'body': h[a5(0x1df)],
                'contactId': h?.[a5(0x176)] ? null : k[a5(0x17b)],
                'fromMe': q[a6(0x170)](n, q[a5(0x202)]) ? !![] : h?.[a5(0x176)],
                'read': !![],
                'mediaType': q[a5(0x1e2)],
                'mediaUrl': undefined,
                'timestamp': new Date()[a5(0x1a6)](),
                'quotedMsgId': h?.[a5(0x20f)]?.['id'],
                'userId': l,
                'scheduleDate': m,
                'sendType': n,
                'status': o,
                'tenantId': i,
                'idFront': p
            };
        try {
            if (q[a5(0x178)](q[a5(0x20c)], q[a5(0x20c)])) {
                const s = {};
                s[a6(0x183)] = k[a6(0x183)], s[a5(0x1e0)] = k[a5(0x187)][a5(0x1e0)], r[a6(0x1df)] = (0x653 * -0x1 + 0x1604 + -0x53b * 0x3, pupa_1[a6(0x181)])(h[a5(0x1df)] || '', s);
                if (q[a5(0x16f)](n, q[a5(0x202)]) && h[a6(0x1e9)]) {
                    if (q[a6(0x1c4)](q[a5(0x1b7)], q[a5(0x197)])) {
                        j = [];
                        const t = await q[a5(0x211)](downloadMedia, h);
                        j[a6(0x21e)](t);
                    } else
                        e[a6(0x17e)][a5(0x1b0)](q[a5(0x1ab)], f);
                }
                q[a6(0x1b4)](n, q[a6(0x202)]) && !h[a6(0x1e9)] && h[a6(0x1e4)] && (j = [], j[a5(0x21e)](h[a6(0x1e4)]));
                if (j) {
                    if (q[a5(0x1c4)](q[a5(0x1f9)], q[a5(0x180)]))
                        await Promise[a6(0x1c1)](j[a6(0x1ff)](async v => {
                            const a8 = a5, a9 = a6, w = {
                                    'ulWVm': function (D, E) {
                                        const a7 = b;
                                        return q[a7(0x16f)](D, E);
                                    },
                                    'AsbyS': q[a8(0x1b1)],
                                    'kGNKD': q[a9(0x17f)],
                                    'cWJHl': function (D, E) {
                                        const aa = a9;
                                        return q[aa(0x211)](D, E);
                                    }
                                };
                            try {
                                if (q[a9(0x1da)](q[a9(0x1b3)], q[a8(0x167)])) {
                                    if (!v[a9(0x1d7)]) {
                                        if (q[a8(0x1da)](q[a8(0x194)], q[a8(0x194)])) {
                                            if (w[a9(0x1e6)](n[a9(0x1dd)][a9(0x171)], -0x1013 + 0xdf4 + -0x1 * -0x3b3)) {
                                                const E = {};
                                                E[a9(0x21b)] = -(-0x1199 + 0x2099 * -0x1 + 0x3233), E[a9(0x1df)] = y[a9(0x1df)], E[a9(0x1f3)] = '', E[a9(0x1d5)] = z[a8(0x1d5)], E[a9(0x16e) + 'y'] = A[a9(0x16e) + 'y'], E[a9(0x1b0)] = B[a9(0x1e8)], E[a8(0x168)] = C[a9(0x218)][a9(0x168)], E[a8(0x161)] = w[a8(0x21d)];
                                                const F = E;
                                                if (D?.[a9(0x218)]?.[a8(0x16d) + a9(0x1ed)]) {
                                                    const G = {};
                                                    G[a9(0x1ac)] = H[a9(0x218)][a9(0x16d) + a9(0x1ed)], G[a8(0x161)] = F[a9(0x161)], G[a8(0x20a)] = F, G[a9(0x186)][a9(0x19d)](w[a9(0x1c7)], G);
                                                }
                                                return {};
                                            }
                                            throw new w(x);
                                        } else {
                                            const E = v[a9(0x1d9)][a8(0x204)]('/')[-0x1 * 0x18b6 + 0x151a + 0x39d][a9(0x204)](';')[-0x8ff + 0xfb * 0x1f + -0x1566];
                                            v[a8(0x1d7)] = new Date()[a8(0x1a6)]() + '.' + E;
                                        }
                                    }
                                } else
                                    throw new z(q[a9(0x21f)]);
                            } catch (G) {
                                q[a8(0x1b4)](q[a8(0x165)], q[a9(0x190)]) ? w[a8(0x1fa)](A, C) : logger_1[a8(0x17e)][a8(0x1b0)](G);
                            }
                            const x = {
                                    ...r,
                                    'body': v[a9(0x1a2) + 'me'],
                                    'mediaUrl': v[a9(0x1d7)],
                                    'mediaType': v[a8(0x1ae)] || v[a9(0x1d9)][a8(0x1ce)](-0x7d6 + 0x307 + 0x4cf * 0x1, v[a9(0x1d9)][a9(0x17c)]('/'))
                                }, y = await Message_1[a8(0x186)][a9(0x1a0)](x), z = {};
                            z[a8(0x220)] = i;
                            const A = {};
                            A[a8(0x173)] = Ticket_1[a9(0x186)], A['as'] = q[a9(0x16a)], A[a9(0x1b2)] = z, A[a9(0x19f)] = [q[a9(0x222)]];
                            const B = await Message_1[a9(0x186)][a9(0x1fd)](y['id'], {
                                'include': [
                                    A,
                                    {
                                        'model': Message_1[a8(0x186)],
                                        'as': q[a9(0x1bd)],
                                        'include': [q[a8(0x222)]]
                                    }
                                ]
                            });
                            if (!B)
                                throw new Error(q[a8(0x21f)]);
                            await k[a8(0x163)]({
                                'lastMessage': B[a9(0x1df)],
                                'lastMessageAt': new Date()[a9(0x1a6)]()
                            });
                            const C = {};
                            C[a9(0x220)] = i, C[a8(0x161)] = q[a9(0x19c)], C[a9(0x20a)] = B, (0x10 * 0x90 + 0x950 + -0x10 * 0x125, socketEmit_1[a9(0x186)])(C);
                            if (!B[a8(0x182) + 'te']) {
                                if (q[a9(0x166)](q[a9(0x196)], q[a9(0x21a)])) {
                                    const K = {};
                                    K[a9(0x21b)] = -(-0x3 * 0xa00 + 0x1 * 0x989 + -0x14 * -0x106), K[a8(0x1df)] = k[a8(0x1df)], K[a9(0x1f3)] = '', K[a9(0x1d5)] = l[a9(0x1d5)], K[a9(0x16e) + 'y'] = m[a9(0x16e) + 'y'], K[a8(0x1b0)] = n[a9(0x1e8)], K[a8(0x168)] = o[a8(0x218)][a8(0x168)], K[a9(0x161)] = q[a8(0x1b1)];
                                    const L = K;
                                    if (p?.[a8(0x218)]?.[a8(0x16d) + a8(0x1ed)]) {
                                        const M = {};
                                        M[a9(0x1ac)] = t[a8(0x218)][a8(0x16d) + a8(0x1ed)], M[a9(0x161)] = L[a8(0x161)], M[a9(0x20a)] = L, s[a9(0x186)][a8(0x19d)](q[a8(0x17f)], M);
                                    }
                                    return {};
                                } else
                                    await (0xdd9 + -0x665 + -0x1 * 0x774, queueValidation_1[a9(0x186)])(k[a8(0x207)], i, [B]);
                            }
                            return B;
                        }));
                    else {
                        if (!g[a5(0x1d7)]) {
                            const w = k[a6(0x1d9)][a5(0x204)]('/')[0x2363 * 0x1 + -0x189c + -0xac6][a5(0x204)](';')[-0x2647 * 0x1 + 0x94c + 0x1cfb * 0x1];
                            l[a5(0x1d7)] = new m()[a6(0x1a6)]() + '.' + w;
                        }
                    }
                } else {
                    const w = { ...r };
                    w[a6(0x1ae)] = q[a6(0x1e2)];
                    const x = await Message_1[a5(0x186)][a6(0x1a0)](w), y = {};
                    y[a5(0x220)] = i;
                    const z = {};
                    z[a5(0x173)] = Ticket_1[a5(0x186)], z['as'] = q[a5(0x16a)], z[a6(0x1b2)] = y, z[a6(0x19f)] = [q[a6(0x222)]];
                    const A = await Message_1[a5(0x186)][a5(0x1fd)](x['id'], {
                        'include': [
                            z,
                            {
                                'model': Message_1[a5(0x186)],
                                'as': q[a6(0x1bd)],
                                'include': [q[a5(0x222)]]
                            }
                        ]
                    });
                    if (!A) {
                        if (q[a6(0x1fb)](q[a6(0x18c)], q[a5(0x18c)])) {
                            const D = z[a6(0x1d9)][a5(0x204)]('/')[-0x415 * -0x9 + -0x1ae5 + -0x9d7][a5(0x204)](';')[0x1d14 + -0x8d2 * 0x3 + -0x29e];
                            B[a6(0x1d7)] = new h()[a6(0x1a6)]() + '.' + D;
                        } else
                            throw new Error(q[a6(0x21f)]);
                    }
                    await k[a6(0x163)]({
                        'lastMessage': A[a5(0x1df)],
                        'lastMessageAt': new Date()[a5(0x1a6)](),
                        'answered': !![]
                    }), A[a6(0x210)] = k;
                    const B = {};
                    return B[a5(0x220)] = i, B[a5(0x161)] = q[a6(0x19c)], B[a5(0x20a)] = A, (-0x1 * 0xcfb + -0x1258 + 0x3 * 0xa71, socketEmit_1[a6(0x186)])(B), !A[a6(0x182) + 'te'] && await (0xaa1 + 0x17c3 + 0x47 * -0x7c, queueValidation_1[a6(0x186)])(k[a5(0x207)], i, [A]), A;
                }
            } else {
                const E = {};
                return E[a6(0x186)] = j, g && E[a6(0x1be)] ? i : E;
            }
        } catch (E) {
            logger_1[a5(0x17e)][a6(0x1b0)](q[a5(0x1ab)], E);
        }
    };
exports[Q(0x186)] = CreateMessageSystemService;