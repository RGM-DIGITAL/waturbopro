'use strict';
const N = b, O = b;
function a() {
    const a8 = [
        'ellei',
        '../../help',
        'ageSystemS',
        'SuddJ',
        'xkoFb',
        'split',
        'vWOhk',
        'alGto',
        'SxOaB',
        'NgTAr',
        'HBiiI',
        'error',
        'chat:creat',
        'kaSlq',
        'qTjVy',
        'ugnVV',
        'mime',
        'IHitn',
        'model',
        'qCemI',
        'UBWRu',
        'mediaType',
        'uSIrk',
        'response',
        'qqsJk',
        'IiVUP',
        'join',
        'HmAfp',
        'extension',
        'where',
        'eonlY',
        '3179895fWfPwO',
        'oBzcg',
        'pGfxs',
        'chat',
        'content-ty',
        'UvQsA',
        'hookMessag',
        'number',
        'stream',
        'scheduleDa',
        'createWrit',
        'gEzxz',
        's/pupa',
        'sASkx',
        'ocYTj',
        'osmhh',
        'gzUDU',
        'headers',
        'messageId',
        'BEFDs',
        '../../util',
        'whatsappId',
        'obFQN',
        'name',
        'uuid',
        'defineProp',
        '117LZLeVj',
        'dfuyD',
        'protocol',
        'logger',
        'yirXz',
        'fromMe',
        's/queueVal',
        'LmuAd',
        'originalna',
        'pupa',
        'Emit',
        'substr',
        'value',
        'puREP',
        's/logger',
        'xDBFk',
        'SAMeD',
        'body',
        'syLmu',
        'create',
        'finish',
        'wQJOu',
        '107034lfTbYS',
        'ngFTh',
        'findByPk',
        '/Queue',
        'public',
        '../../mode',
        'ls/Message',
        'rgYkK',
        'npofM',
        'kOAWQ',
        'contact',
        'ViOri',
        'RYhEI',
        'media',
        'nvGZc',
        'responseTy',
        'quotedMsg',
        'qyGAy',
        'contactId',
        'type',
        'tGAxx',
        'AaKSr',
        'indexOf',
        'ERROR\x20DONW',
        'payload',
        '8dKgwRu',
        'JaZkQ',
        'Smyuv',
        '441OFkpIL',
        '13863pPRJYJ',
        'Qiucb',
        '__esModule',
        'aptpH',
        'amHUi',
        'IVkls',
        'LOAD',
        'NWgnb',
        'uttVy',
        '272986Ssyrxs',
        'all',
        'rhfNf',
        'zYfaU',
        'ASLax',
        'ers/socket',
        '_SYSTEM',
        'getTime',
        'mediaUrl',
        'tenantId',
        'qYoLf',
        'API',
        'eTlDT',
        'qgcEH',
        'WOamq',
        'include',
        'NG_MESSAGE',
        'map',
        'urlMessage',
        'message',
        'get',
        'status',
        'externalKe',
        'ls/Ticket',
        'recursive',
        'axios',
        'QfCHx',
        'bMFIZ',
        'filename',
        'VNEKm',
        'GxAhu',
        'XgELN',
        'oVsNV',
        'bYBQH',
        'fault',
        '1679513QWRJSD',
        'apiConfig',
        'Kbzvv',
        'push',
        'update',
        'Status',
        'eStatus',
        '../../libs',
        'authToken',
        'eStream',
        'WebHooksAP',
        'qSHen',
        'pipe',
        'idation',
        'cIZyK',
        'kaAyw',
        'ticket',
        'ervice',
        'erty',
        'OwZEh',
        'url',
        '314770XsnITA',
        'ERR_CREATI',
        'CreateMess',
        'rmdirSync',
        'mimetype',
        'yHIdg',
        'data',
        'dBCze',
        'path',
        'qEFxB',
        '__importDe',
        'vNaFI',
        'HUuNO',
        '72DoUKFM',
        'RzbXN',
        'CSGer',
        'qxKsY',
        'default',
        'ack',
        'Onynk',
        'xHfOU',
        'FfYyf',
        '5967960wFwjPK',
        'add'
    ];
    a = function () {
        return a8;
    };
    return a();
}
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (0x8 * -0x224 + 0x2454 + 0x90e * -0x2);
        let h = e[f];
        return h;
    }, b(c, d);
}
(function (c, d) {
    const L = b, M = b, e = c();
    while (!![]) {
        try {
            const f = -parseInt(L(0x1b5)) / (-0x1c8e + -0x1 * 0x1666 + 0x1 * 0x32f5) * (parseInt(M(0x1a8)) / (0x1dd7 + 0x1f5d + -0x3d32)) + parseInt(L(0x1ac)) / (0x19a1 + 0x2 * 0x71b + -0x27d4) * (parseInt(M(0x135)) / (-0x17b1 + -0x1 * -0xbf1 + 0xbc4)) + parseInt(L(0x15f)) / (0x1 * 0x107 + 0x1d79 + 0x11 * -0x1cb) + -parseInt(L(0x18f)) / (-0x17 + -0x416 + 0x433) * (-parseInt(M(0x1ab)) / (0xb61 + 0x24b2 + 0x267 * -0x14)) + -parseInt(L(0x13e)) / (0x161 * 0xd + 0x12a + -0x11f * 0x11) + -parseInt(L(0x179)) / (0x22d + 0x1332 + -0x1556) * (-parseInt(M(0x128)) / (0x2b8 + -0x1 * -0x109 + -0x13d * 0x3)) + parseInt(L(0x1d8)) / (-0x88b + -0x1 * 0x9bf + -0x1 * -0x1255);
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, -0x349 * -0x77 + 0x8a781 + -0x37f7 * 0x7));
var __importDefault = this && this[N(0x132) + N(0x1d7)] || function (c) {
    const P = O;
    return c && c[P(0x1ae)] ? c : { 'default': c };
};
const J = {};
J[O(0x185)] = !![], Object[O(0x178) + O(0x125)](exports, N(0x1ae), J);
const fs_1 = __importDefault(require('fs')), path_1 = require(O(0x130)), axios_1 = __importDefault(require(N(0x1ce))), mime_1 = __importDefault(require(N(0x150))), uuid_1 = require(O(0x177)), logger_1 = require(N(0x173) + N(0x187)), Ticket_1 = __importDefault(require(N(0x194) + N(0x1cc))), Message_1 = __importDefault(require(O(0x194) + N(0x195))), socketEmit_1 = __importDefault(require(N(0x141) + N(0x1ba) + N(0x183))), Queue_1 = __importDefault(require(O(0x11a) + O(0x192))), pupa_1 = require(O(0x173) + N(0x16b)), queueValidation_1 = __importDefault(require(N(0x173) + N(0x17f) + N(0x120))), downloadMedia = async g => {
        const Q = N, R = N, h = {
                'qSHen': function (i, j) {
                    return i === j;
                },
                'UvQsA': Q(0x14a),
                'kOAWQ': function (i, j) {
                    return i(j);
                },
                'IHitn': Q(0x1a6) + Q(0x1b2),
                'HUuNO': function (i, j) {
                    return i !== j;
                },
                'eTlDT': R(0x133),
                'cIZyK': Q(0x14e),
                'Qiucb': Q(0x18d),
                'WOamq': R(0x14b),
                'syLmu': Q(0x129) + R(0x1c5) + Q(0x1bb),
                'IiVUP': Q(0x167),
                'amHUi': Q(0x163) + 'pe',
                'NWgnb': R(0x193),
                'aptpH': Q(0x197),
                'yHIdg': R(0x165) + R(0x119),
                'xkoFb': R(0x11d) + 'I'
            };
        try {
            const i = {};
            i[R(0x19e) + 'pe'] = h[Q(0x159)];
            const j = await axios_1[Q(0x139)][Q(0x1c9)](g[R(0x1bd)], i), k = j[R(0x170)][h[Q(0x1b0)]], l = mime_1[R(0x139)], m = l[R(0x15c)](k), n = (0x2a9 * 0x8 + 0xd5a + -0x22a2, uuid_1['v4'])(), o = (-0x1 * 0x250c + -0x7 * -0x283 + 0x97 * 0x21, path_1[R(0x15a)])(__dirname, '..', '..', '..', h[R(0x1b3)]), p = n + '.' + m, q = (0x13b + 0x16c1 * -0x1 + 0x1586, path_1[R(0x15a)])(o, p), r = {};
            r[Q(0x181) + 'me'] = p, r[Q(0x1d1)] = p, r[R(0x155)] = m;
            const s = r;
            return await new Promise((t, u) => {
                const S = Q, U = Q, v = {
                        'ocYTj': h[S(0x151)],
                        'ellei': function (w, x) {
                            const T = S;
                            return h[T(0x198)](w, x);
                        }
                    };
                if (h[U(0x134)](h[U(0x1c1)], h[U(0x121)]))
                    j[S(0x12e)][U(0x11f)](fs_1[U(0x139)][S(0x169) + S(0x11c)](q))['on'](h[U(0x1ad)], async () => {
                        const V = S, W = U;
                        if (h[V(0x11e)](h[V(0x164)], h[V(0x164)]))
                            h[V(0x198)](t, s);
                        else {
                            const x = {};
                            return x[V(0x139)] = j, g && h[W(0x1ae)] ? i : x;
                        }
                    })['on'](h[S(0x1c3)], w => {
                        const X = S, Y = U;
                        console[X(0x14b)](v[X(0x16d)], w);
                        const x = {};
                        x[Y(0x1cd)] = !![], fs_1[Y(0x139)][X(0x12b)](q, x), v[X(0x140)](u, new Error(w));
                    });
                else {
                    const x = f[U(0x12c)][S(0x145)]('/')[0x1e62 + -0x258d + 0x72c][S(0x145)](';')[-0x6e + -0x243 * -0x1 + 0x43 * -0x7];
                    g[S(0x1d1)] = new h()[S(0x1bc)]() + '.' + x;
                }
            }), s;
        } catch (t) {
            if (h[R(0x11e)](t[R(0x157)][Q(0x1ca)], 0x3 * -0x7c5 + 0x24e8 + -0xc05)) {
                if (h[R(0x11e)](h[Q(0x1af)], h[R(0x1af)])) {
                    const u = {};
                    u[R(0x13a)] = -(0x1183 * -0x2 + -0x3d8 * -0x9 + 0x25 * 0x3), u[Q(0x18a)] = g[R(0x18a)], u[R(0x171)] = '', u[R(0x166)] = g[R(0x166)], u[R(0x1cb) + 'y'] = g[R(0x1cb) + 'y'], u[Q(0x14b)] = t[R(0x1c8)], u[R(0x11b)] = g[Q(0x1d9)][R(0x11b)], u[Q(0x1a2)] = h[Q(0x12d)];
                    const v = u;
                    if (g?.[R(0x1d9)]?.[R(0x1c7) + Q(0x118)]) {
                        const w = {};
                        w[Q(0x127)] = g[R(0x1d9)][Q(0x1c7) + R(0x118)], w[R(0x1a2)] = v[Q(0x1a2)], w[Q(0x1a7)] = v, Queue_1[Q(0x139)][R(0x13f)](h[Q(0x144)], w);
                    }
                    return {};
                } else
                    throw new d(h[R(0x18b)]);
            }
            throw new Error(t);
        }
    }, CreateMessageSystemService = async ({
        msg: h,
        tenantId: i,
        medias: j,
        ticket: k,
        userId: l,
        scheduleDate: m,
        sendType: n,
        status: o,
        idFront: p
    }) => {
        const Z = N, a0 = N, q = {
                'AaKSr': Z(0x165) + a0(0x119),
                'puREP': Z(0x11d) + 'I',
                'rhfNf': function (s, t) {
                    return s(t);
                },
                'oBzcg': a0(0x1a6) + a0(0x1b2),
                'qyGAy': function (s, t) {
                    return s !== t;
                },
                'XgELN': Z(0x136),
                'ViOri': a0(0x1b8),
                'CSGer': function (s, t) {
                    return s === t;
                },
                'LmuAd': Z(0x1d5),
                'SAMeD': Z(0x190),
                'bYBQH': function (s, t) {
                    return s === t;
                },
                'yirXz': a0(0x146),
                'Onynk': Z(0x123),
                'ASLax': a0(0x199),
                'alGto': a0(0x19f),
                'sASkx': a0(0x129) + a0(0x1c5) + Z(0x1bb),
                'gEzxz': Z(0x14c) + 'e',
                'xHfOU': function (s, t) {
                    return s !== t;
                },
                'rgYkK': Z(0x15b),
                'Smyuv': a0(0x172),
                'bMFIZ': Z(0x12a) + Z(0x142) + Z(0x124),
                'eonlY': function (s, t) {
                    return s(t);
                },
                'qxKsY': function (s, t) {
                    return s(t);
                },
                'SxOaB': a0(0x18d),
                'VNEKm': Z(0x14b),
                'wQJOu': function (s, t) {
                    return s === t;
                },
                'qEFxB': Z(0x1c0),
                'RYhEI': Z(0x162),
                'uSIrk': function (s, t) {
                    return s === t;
                },
                'nvGZc': Z(0x13d),
                'gzUDU': function (s, t) {
                    return s === t;
                },
                'UBWRu': function (s, t) {
                    return s === t;
                },
                'qgcEH': Z(0x14d),
                'qqsJk': a0(0x1cf),
                'SuddJ': function (s, t) {
                    return s(t);
                },
                'tGAxx': function (s, t) {
                    return s !== t;
                },
                'NgTAr': Z(0x1a9),
                'obFQN': a0(0x122),
                'qYoLf': function (s, t) {
                    return s === t;
                },
                'GxAhu': a0(0x153),
                'dBCze': function (s, t) {
                    return s === t;
                },
                'osmhh': a0(0x1da),
                'ugnVV': a0(0x188),
                'uttVy': Z(0x126)
            }, r = {
                'ticketId': k['id'],
                'body': h[Z(0x18a)],
                'contactId': h?.[Z(0x17e)] ? null : k[a0(0x1a1)],
                'fromMe': q[Z(0x18e)](n, q[a0(0x131)]) ? !![] : h?.[a0(0x17e)],
                'read': !![],
                'mediaType': q[Z(0x19b)],
                'mediaUrl': undefined,
                'timestamp': new Date()[Z(0x1bc)](),
                'quotedMsgId': h?.[a0(0x19f)]?.['id'],
                'userId': l,
                'scheduleDate': m,
                'sendType': n,
                'status': o,
                'tenantId': i,
                'idFront': p
            };
        try {
            if (q[a0(0x156)](q[a0(0x19d)], q[a0(0x19d)])) {
                const s = {};
                s[a0(0x17b)] = k[a0(0x17b)], s[a0(0x176)] = k[Z(0x199)][Z(0x176)], r[Z(0x18a)] = (-0xab4 * 0x2 + -0x3 * 0xb6c + 0x4 * 0xdeb, pupa_1[a0(0x182)])(h[Z(0x18a)] || '', s);
                if (q[Z(0x16f)](n, q[a0(0x131)]) && h[Z(0x1bd)]) {
                    if (q[Z(0x154)](q[Z(0x1c2)], q[a0(0x158)])) {
                        const v = {};
                        v[Z(0x13a)] = -(0x19ac + -0x21a + -0x1791), v[Z(0x18a)] = k[Z(0x18a)], v[Z(0x171)] = '', v[a0(0x166)] = l[Z(0x166)], v[Z(0x1cb) + 'y'] = m[a0(0x1cb) + 'y'], v[a0(0x14b)] = n[Z(0x1c8)], v[Z(0x11b)] = o[a0(0x1d9)][Z(0x11b)], v[Z(0x1a2)] = q[a0(0x1a4)];
                        const w = v;
                        if (p?.[a0(0x1d9)]?.[a0(0x1c7) + a0(0x118)]) {
                            const x = {};
                            x[Z(0x127)] = t[Z(0x1d9)][Z(0x1c7) + Z(0x118)], x[a0(0x1a2)] = w[Z(0x1a2)], x[a0(0x1a7)] = w, s[Z(0x139)][a0(0x13f)](q[Z(0x186)], x);
                        }
                        return {};
                    } else {
                        j = [];
                        const u = await q[a0(0x143)](downloadMedia, h);
                        j[Z(0x1db)](u);
                    }
                }
                q[a0(0x156)](n, q[Z(0x131)]) && !h[a0(0x1bd)] && h[a0(0x19c)] && (j = [], j[a0(0x1db)](h[a0(0x19c)]));
                if (j)
                    q[Z(0x1a3)](q[a0(0x149)], q[Z(0x175)]) ? await Promise[a0(0x1b6)](j[a0(0x1c6)](async v => {
                        const a2 = a0, a3 = a0, w = {
                                'dfuyD': function (x, y) {
                                    const a1 = b;
                                    return q[a1(0x1b7)](x, y);
                                },
                                'pGfxs': q[a2(0x160)]
                            };
                        if (q[a2(0x1a0)](q[a2(0x1d4)], q[a2(0x19a)])) {
                            try {
                                if (q[a3(0x137)](q[a3(0x180)], q[a3(0x189)])) {
                                    if (!g[a2(0x1d1)]) {
                                        const E = k[a2(0x12c)][a2(0x145)]('/')[0x279 + 0x4e * 0x25 + 0x2 * -0x6df][a3(0x145)](';')[0x354 + -0x7f2 + -0x3 * -0x18a];
                                        l[a3(0x1d1)] = new m()[a2(0x1bc)]() + '.' + E;
                                    }
                                } else {
                                    if (!v[a3(0x1d1)]) {
                                        const E = v[a2(0x12c)][a2(0x145)]('/')[-0x11b4 + -0x1722 + -0x29 * -0xff][a2(0x145)](';')[-0x2 * 0x12d6 + 0x1a6c + -0x2 * -0x5a0];
                                        v[a3(0x1d1)] = new Date()[a2(0x1bc)]() + '.' + E;
                                    }
                                }
                            } catch (F) {
                                q[a3(0x1d6)](q[a3(0x17d)], q[a2(0x17d)]) ? logger_1[a2(0x17c)][a3(0x14b)](F) : (C = [], g[a2(0x1db)](h[a2(0x19c)]));
                            }
                            const x = {
                                    ...r,
                                    'body': v[a2(0x181) + 'me'],
                                    'mediaUrl': v[a2(0x1d1)],
                                    'mediaType': v[a2(0x155)] || v[a3(0x12c)][a3(0x184)](-0x2303 * -0x1 + 0x2b * -0x49 + -0x16c0, v[a3(0x12c)][a2(0x1a5)]('/'))
                                }, y = await Message_1[a2(0x139)][a2(0x18c)](x), z = {};
                            z[a3(0x1be)] = i;
                            const A = {};
                            A[a3(0x152)] = Ticket_1[a2(0x139)], A['as'] = q[a2(0x13b)], A[a2(0x15d)] = z, A[a2(0x1c4)] = [q[a2(0x1b9)]];
                            const B = await Message_1[a3(0x139)][a3(0x191)](y['id'], {
                                'include': [
                                    A,
                                    {
                                        'model': Message_1[a3(0x139)],
                                        'as': q[a3(0x147)],
                                        'include': [q[a3(0x1b9)]]
                                    }
                                ]
                            });
                            if (!B)
                                throw new Error(q[a2(0x16c)]);
                            await k[a2(0x1dc)]({
                                'lastMessage': B[a3(0x18a)],
                                'lastMessageAt': new Date()[a3(0x1bc)]()
                            });
                            const C = {};
                            return C[a3(0x1be)] = i, C[a3(0x1a2)] = q[a2(0x16a)], C[a3(0x1a7)] = B, (-0x1 * -0x1a93 + 0xade + -0x87 * 0x47, socketEmit_1[a2(0x139)])(C), !B[a2(0x168) + 'te'] && (q[a2(0x13c)](q[a3(0x196)], q[a3(0x1aa)]) ? await (-0x1c94 + 0x21a + 0x1a7a, queueValidation_1[a2(0x139)])(k[a3(0x174)], i, [B]) : w[a3(0x17a)](A, C)), B;
                        } else {
                            j[a3(0x14b)](w[a2(0x161)], k);
                            const K = {};
                            K[a2(0x1cd)] = !![], l[a3(0x139)][a3(0x12b)](m, K), w[a3(0x17a)](n, new o(p));
                        }
                    })) : e[Z(0x17c)][a0(0x14b)](f);
                else {
                    if (q[a0(0x1bf)](q[a0(0x1d3)], q[a0(0x1d3)])) {
                        const w = { ...r };
                        w[Z(0x155)] = q[Z(0x19b)];
                        const x = await Message_1[Z(0x139)][a0(0x18c)](w), y = {};
                        y[Z(0x1be)] = i;
                        const z = {};
                        z[Z(0x152)] = Ticket_1[a0(0x139)], z['as'] = q[a0(0x13b)], z[a0(0x15d)] = y, z[a0(0x1c4)] = [q[Z(0x1b9)]];
                        const A = await Message_1[Z(0x139)][Z(0x191)](x['id'], {
                            'include': [
                                z,
                                {
                                    'model': Message_1[Z(0x139)],
                                    'as': q[Z(0x147)],
                                    'include': [q[a0(0x1b9)]]
                                }
                            ]
                        });
                        if (!A) {
                            if (q[a0(0x12f)](q[a0(0x16e)], q[a0(0x16e)]))
                                throw new Error(q[a0(0x16c)]);
                            else {
                                const D = {};
                                D[a0(0x127)] = h[Z(0x1d9)][Z(0x1c7) + a0(0x118)], D[Z(0x1a2)] = i[Z(0x1a2)], D[a0(0x1a7)] = j, D[a0(0x139)][a0(0x13f)](q[a0(0x186)], D);
                            }
                        }
                        await k[a0(0x1dc)]({
                            'lastMessage': A[a0(0x18a)],
                            'lastMessageAt': new Date()[a0(0x1bc)](),
                            'answered': !![]
                        }), A[a0(0x123)] = k;
                        const B = {};
                        return B[Z(0x1be)] = i, B[Z(0x1a2)] = q[Z(0x16a)], B[a0(0x1a7)] = A, (-0x2cf * -0x1 + 0xfc7 + -0x7a * 0x27, socketEmit_1[Z(0x139)])(B), !A[a0(0x168) + 'te'] && await (-0x1297 + 0x6 * 0x595 + -0xee7, queueValidation_1[Z(0x139)])(k[Z(0x174)], i, [A]), A;
                    } else {
                        if (q[Z(0x1d6)](n[a0(0x157)][a0(0x1ca)], -0x1d * -0x8f + -0x6 * -0x7d + -0x118d)) {
                            const E = {};
                            E[a0(0x13a)] = -(0x10d4 + -0x20ae + -0x9 * -0x1c3), E[a0(0x18a)] = y[a0(0x18a)], E[a0(0x171)] = '', E[a0(0x166)] = z[Z(0x166)], E[Z(0x1cb) + 'y'] = A[a0(0x1cb) + 'y'], E[Z(0x14b)] = B[a0(0x1c8)], E[Z(0x11b)] = C[a0(0x1d9)][Z(0x11b)], E[Z(0x1a2)] = q[a0(0x1a4)];
                            const F = E;
                            if (D?.[Z(0x1d9)]?.[a0(0x1c7) + a0(0x118)]) {
                                const G = {};
                                G[a0(0x127)] = H[a0(0x1d9)][Z(0x1c7) + Z(0x118)], G[a0(0x1a2)] = F[Z(0x1a2)], G[Z(0x1a7)] = F, G[a0(0x139)][Z(0x13f)](q[Z(0x186)], G);
                            }
                            return {};
                        }
                        throw new w(x);
                    }
                }
            } else
                e[a0(0x17c)][Z(0x14b)](q[a0(0x1d0)], f);
        } catch (F) {
            if (q[Z(0x1a3)](q[Z(0x14f)], q[Z(0x1b4)]))
                logger_1[Z(0x17c)][Z(0x14b)](q[Z(0x1d0)], F);
            else {
                const H = {
                    'IVkls': function (I, K) {
                        const a4 = a0;
                        return q[a4(0x138)](I, K);
                    }
                };
                m[Z(0x12e)][a0(0x11f)](n[Z(0x139)][a0(0x169) + a0(0x11c)](o))['on'](q[a0(0x148)], async () => {
                    const a5 = a0;
                    H[a5(0x1b1)](w, x);
                })['on'](q[Z(0x1d2)], I => {
                    const a6 = a0, a7 = Z;
                    w[a6(0x14b)](q[a6(0x160)], I);
                    const K = {};
                    K[a6(0x1cd)] = !![], x[a7(0x139)][a7(0x12b)](y, K), q[a6(0x15e)](z, new A(I));
                });
            }
        }
    };
exports[O(0x139)] = CreateMessageSystemService;